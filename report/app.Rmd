---
title: "Visualization tool"
output: 
  html_document:
    highlight: tango
    toc: true
    toc_float:
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# What is it?

An R Shiny app to interactively visualize flood forecasting data and model results.

# Why was it developed?

A full-blown website is already used daily for the flood warning service: [xgeo](www.xgeo.no)
As it is open to the public and can slow down during periods of intense use. It also does not allow plotting multiple model results at once.
This R application was developed to complement xgeo and serve as a prototyping platform before new ideas are eventually implemented in xgeo.

# What does it do?

The GUI is based on R Shiny, with the following tabs:

1. Multi-model forecaster's dashboard.
**Tab 1a:**

Plots of model runs from -20 to +9 days. It is also possible to view the last year of forecast data. 

    - Selection of a multiple stations based on region number, main number, clicking on map
    - Map markers can represent a selectable variable (currently flood_warning and uncertainty. could be extended to temperature / precip...)
    - Interactive multi-model plot: available models are HBV and DDD for the moment. The plot can include flood levels: mean flood and 5 year return level.

**Tab 1b:**

Same plots but a polygon selection tool allows selecting multiple neighbouring stations.
 
![Screenshot of the multi-model forecaster's dashboard](images/tab1.png)

![Screenshot of the forecaster's dashboard with polygon selection](images/tab2a.png)

![Screenshot of the forecaster's dashboard with flood return levels](images/tab1.png)
 
2. Tab 2: Single model / Single station

In addition to *discharge*, the plot also shows *state* (soil moisture, snow height) and *input* (temperature, precipitation) data.

3. Tab 3: Modeller's dashboard

Analysis of model performance / properties during the calibration period.
  - time series graphs, available time period, zoom functionality, tick on/off which models:
  - discharge: observations and all models
  - temperature and precipitation
  - Summary of model performance. There is the tricky question of how long of a time-interval to use. All perf indicators should use the same interval. 1 year is probably a good choice
     - NSE
     - KGE
     - Taylor diagram
     - Hit/miss/false alarm/correct reject table. If the timelapse is 1 year, the return level threshold should be discussed, 1 year return period being the maximum we could use.

Further ideas:
Regional analysis of model runs
Ouputs one plot per station of the model runs
Should this include a map with polygon selection or should the group of stations only originate from tab 1?

Historical hindsight: pull out past interesting events for a specific station or group of stations

Not all the files have data for the same number of stations (120-145). Check how the station numbers are organized.
Those files don't include catchment properties, so we will have to agree on the data files for those properties.
The observed flow and precip/temperature are included in all of those files.

# How to run it?

After installing the `shiny`R package, you can run this application from anywhere with the following commands:
`library(shiny)`
`runGitHub("Flood_forecasting", "fbaffie")`
The aim is to have the .RData files that are read by the application

# How to use it?

Annoted screenshots to come.

# How to modify it or develop it further?

Please refer to the package [documentation](http://NVE.github.io/Flood_forecasting/index.html) for the programming details of this app.

